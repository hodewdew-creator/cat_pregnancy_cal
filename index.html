<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>고양이 임신·출산 계산기</title>
  <meta name="description" content="교배일/HD/BPD로 고양이 분만 예정일을 계산하고 범위를 보여주는 계산기" />
  <style>
    :root{ --blue:#003366; --bg:#f1f5f9; --card:#ffffff; --border:#d1d5db; --text:#1f2937; --muted:#64748b; --accent:#dbeafe; --range:#fff7ed; --avg:#dcfce7 }
    *{box-sizing:border-box}
    body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:0;padding:16px;background:var(--bg);color:var(--text)}
    h1{margin:0 0 12px;text-align:center;color:var(--blue);font-size:1.45rem}
    .card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px;margin:0 auto 16px;max-width:820px;box-shadow:0 2px 6px rgba(0,0,0,.04)}
    label{display:block;margin:10px 0 6px;font-weight:600;color:#0f172a}
    select,input,button{font-size:1rem}
    select,input{padding:9px;border:1px solid var(--border);border-radius:8px;width:100%;max-width:300px}
    button{background:var(--blue);color:#fff;border:none;padding:10px 14px;border-radius:10px;cursor:pointer}
    .row{display:flex;gap:14px;flex-wrap:wrap;align-items:flex-end}
    .result{margin-top:16px;line-height:1.7}
    .pill{display:inline-block;background:var(--accent);color:#0f172a;border:1px solid var(--border);padding:6px 10px;border-radius:999px;font-size:.92rem;margin-right:8px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .grid .item{background:#f8fafc;border:1px solid var(--border);border-radius:10px;padding:10px}
    .item h4{margin:0 0 6px;font-size:1rem}
    .muted{color:var(--muted);font-size:.9rem}
    .help{font-size:.9rem;color:var(--muted);margin-top:6px}
    .inline{display:flex;gap:8px;align-items:center}
    .warn{color:#b91c1c;font-weight:600}

    /* 달력 */
    .calendar{margin-top:12px}
    .cal-head{display:flex;justify-content:space-between;align-items:center;margin:4px 0 8px}
    .cal-title{font-weight:700}
    table.cal{width:100%;border-collapse:collapse;font-size:.92rem;table-layout:fixed;border:1px solid var(--border);border-radius:10px;overflow:hidden}
    .cal th,.cal td{border:1px solid var(--border);padding:8px;text-align:right;vertical-align:top;height:44px}
    .cal th{background:#f8fafc;color:#0f172a;font-weight:600;text-align:center}
    .cal td .d{float:right}
    .cal td.dim{color:#cbd5e1;background:#f8fafc}
    .cal td.range{background:var(--range)}
    .cal td.avg{background:var(--avg);font-weight:700}
    .legend{display:flex;gap:10px;margin-top:8px;font-size:.85rem;color:#334155}
    .legend span{display:inline-flex;align-items:center;gap:6px}
    .legend i{display:inline-block;width:14px;height:14px;border:1px solid var(--border)}
    .legend i.l-range{background:var(--range)}
    .legend i.l-avg{background:var(--avg)}

    @media(max-width:640px){.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <h1>고양이 임신·출산 계산기</h1>
  <div class="card">
    <div class="row">
      <div>
        <label for="method">계산 방법</label>
        <select id="method">
          <option value="mating">교배일 기준</option>
          <option value="hd">HD(cm) 측정</option>
          <option value="bpd">BPD(mm) 측정</option>
        </select>
      </div>
      <div id="inputBox" class="inline"></div>
      <div>
        <button id="btnCalc">계산하기</button>
      </div>
    </div>
    <div class="help" id="hint">교배일을 알면 평균 64일, 범위 58–67일로 분만을 예측합니다.</div>

    <div class="result" id="resultBox"></div>
    <div class="calendar" id="calendarWrap" style="display:none">
      <div class="cal-head"><div class="cal-title" id="calTitle"></div></div>
      <table class="cal" id="calTable"></table>
      <div class="legend"><span><i class="l-range"></i> 정상 범위</span><span><i class="l-avg"></i> 평균 예정일</span></div>
    </div>
  </div>

  <div class="card">
    <h3 style="margin:0 0 8px">참고 타임라인</h3>
    <div class="grid">
      <div class="item"><h4>임신 30일 전후</h4><div class="muted">초음파 임신 확인 시기</div></div>
      <div class="item"><h4>임신 45일 이후</h4><div class="muted">X-ray로 태수 확인 가능</div></div>
      <div class="item"><h4>평균 분만</h4><div class="muted">교배 후 약 64일</div></div>
      <div class="item"><h4>정상 범위</h4><div class="muted">교배 후 58–67일</div></div>
    </div>
  </div>

<script>
  const methodEl = document.getElementById('method');
  const inputBox = document.getElementById('inputBox');
  const hint = document.getElementById('hint');
  const resultBox = document.getElementById('resultBox');
  const btnCalc = document.getElementById('btnCalc');
  const calendarWrap = document.getElementById('calendarWrap');
  const calTable = document.getElementById('calTable');
  const calTitle = document.getElementById('calTitle');

  methodEl.addEventListener('change', () => { renderInputs(); clearOutputs(); });
  btnCalc.addEventListener('click', calculate);

  function clearOutputs(){ resultBox.innerHTML=''; calendarWrap.style.display='none'; }
  function pad(n){ return n.toString().padStart(2,'0'); }
  function formatDate(d){ return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`; }
  function addDays(d, n){ const x=new Date(d); x.setDate(x.getDate()+n); return x; }

  function renderInputs(){
    const m = methodEl.value;
    if(m==='mating'){
      inputBox.innerHTML = `
        <div>
          <label for="date">교배일</label>
          <input type="date" id="date">
        </div>`;
      hint.textContent = '교배일 기준: 평균 64일, 정상 범위 58–67일';
    } else if(m==='hd'){
      inputBox.innerHTML = `
        <div>
          <label for="hd">HD (cm)</label>
          <input type="number" id="hd" step="0.1" placeholder="예: 2.8">
        </div>`;
      hint.textContent = 'HD(Head diameter, cm)로 임신일령(GA) 추정: GA ≈ 25×HD + 3 (일)';
    } else {
      inputBox.innerHTML = `
        <div>
          <label for="bpd">BPD (mm)</label>
          <input type="number" id="bpd" step="0.1" placeholder="예: 23.5">
        </div>`;
      hint.textContent = 'BPD(Biparietal diameter, mm)로 남은 일수 추정: 남은일 ≈ (BPD−23.39)/0.47';
    }
  }

  function renderCalendar(avgDate, startDate, endDate){
    // 한 달짜리 달력(평균 예정일이 속한 달)
    calendarWrap.style.display='block';
    const y = avgDate.getFullYear();
    const m = avgDate.getMonth(); // 0-based
    calTitle.textContent = `${y}년 ${m+1}월`;

    const first = new Date(y, m, 1);
    const last = new Date(y, m+1, 0);
    const startWeekday = first.getDay(); // 0=일
    const daysInMonth = last.getDate();

    const prevLast = new Date(y, m, 0).getDate();

    let html = '<thead><tr>'+
      ['일','월','화','수','목','금','토'].map(d=>`<th>${d}</th>`).join('')+
      '</tr></thead><tbody>';

    let day = 1;
    for(let r=0;r<6;r++){
      html += '<tr>';
      for(let c=0;c<7;c++){
        let cellDate, cls='';
        if(r===0 && c<startWeekday){
          // 이전달
          const d = prevLast - (startWeekday - c - 1);
          cellDate = new Date(y, m-1, d);
          cls='dim';
        } else if(day>daysInMonth){
          // 다음달
          const d = day - daysInMonth;
          cellDate = new Date(y, m+1, d);
          cls='dim';
          day++;
        } else {
          cellDate = new Date(y, m, day);
          day++;
        }
        // 범위/평균 표시 (해당 월 내부만 칠함)
        if(!cls){
          const inRange = cellDate>=startDate && cellDate<=endDate;
          if(inRange) cls+=' range';
          if(cellDate.toDateString()===avgDate.toDateString()) cls+=' avg';
        }
        html += `<td class="${cls.trim()}"><span class="d">${cellDate.getDate()}</span></td>`;
      }
      html += '</tr>';
      if(day>daysInMonth) break;
    }
    html += '</tbody>';
    calTable.innerHTML = html;
  }

  function calculate(){
    const m = methodEl.value;
    let avgDate=null, startDate=null, endDate=null, desc='';

    if(m==='mating'){
      const dateEl = document.getElementById('date');
      const mating = new Date(dateEl.value);
      if(isNaN(mating)) return alert('교배일을 입력하세요.');
      avgDate = addDays(mating, 64);
      startDate = addDays(mating, 58);
      endDate = addDays(mating, 67);
      desc = `교배일: <span class="pill">${formatDate(mating)}</span>`;
    }
    else if(m==='hd'){
      const v = parseFloat(document.getElementById('hd').value);
      if(!(v>0)) return alert('HD 값을 입력하세요.');
      const GA = Math.round(25*v + 3); // days
      const today = new Date();
      avgDate = addDays(today, 64 - GA);
      startDate = addDays(today, 58 - GA);
      endDate = addDays(today, 67 - GA);
      desc = `HD=${v} cm → GA 약 <span class="pill">${GA}일</span>`;
    }
    else if(m==='bpd'){
      const v = parseFloat(document.getElementById('bpd').value);
      if(!(v>0)) return alert('BPD 값을 입력하세요.');
      const remain = Math.round((v - 23.39)/0.47);
      const today = new Date();
      avgDate = addDays(today, remain);
      startDate = addDays(avgDate, -2);
      endDate = addDays(avgDate, 2);
      desc = `BPD=${v} mm → 남은 일수 약 <span class="pill">${remain}일</span>`;
    }

    resultBox.innerHTML = `
      <div>예상 분만일(평균): <span class="pill">${formatDate(avgDate)}</span></div>
      <div>정상 범위: <span class="pill">${formatDate(startDate)}</span> ~ <span class="pill">${formatDate(endDate)}</span></div>
      <div class="muted" style="margin-top:6px">${desc}</div>
      <div class="help" style="margin-top:8px">※ 본 계산기는 보조 도구이며, 실제 임상 판단은 환자 상태와 영상/검사 결과를 함께 고려하세요.</div>
    `;

    renderCalendar(avgDate, startDate, endDate);
  }

  // 초기 렌더
  renderInputs();
</script>
</body>
</html>
